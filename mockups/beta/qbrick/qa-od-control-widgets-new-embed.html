<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>QPlayer – New Embed Event Test</title>

    <style>
      qplayer-embed {
        display: block;
        width: 100%;
        margin-bottom: 24px;
      }
    </style>
  </head>

  <body>
    <h3>Player 1 controls</h3>
    <button onclick="play()">Play</button>
    <button onclick="pause()">Pause</button>
    <button onclick="mute()">Mute</button>
    <button onclick="unMute()">Unmute</button>
    <button onclick="jumpTo10()">Jump to 10s</button>

    <div style="margin-top: 8px;">
      Position: <span id="playerPos1">00:00</span>
    </div>

    <h3>Player 1</h3>
    <qplayer-embed
      data-qplayer-id="player-1"
      data-qplayer-account-id="AccPn4oB8ooNEqDOBpvqxDBIA"
      data-qplayer-media-id="047226d5-00090291-19993686"
      data-qplayer-inline="on"
      data-qplayer-aspect-ratio="16/9">
    </qplayer-embed>

    <h3>Player 2 (paused when Player 1 plays)</h3>
    <div>
      Position: <span id="playerPos2">00:00</span>
    </div>

    <qplayer-embed
      data-qplayer-id="player-2"
      data-qplayer-account-id="AccPn4oB8ooNEqDOBpvqxDBIA"
      data-qplayer-media-id="75a1666f-ce10-46a5-86a1-996a636f39b2"
      data-qplayer-inline="on"
      data-qplayer-aspect-ratio="16/9"
      data-qplayer-autoplay="true"
      data-qplayer-mute="true">
    </qplayer-embed>

    <script src="https://play2.qbrick.com/qplayer-beta/qplayer.min.js"></script>

    <script>
      // ---------- helpers ----------

      function getVideo(playerId) {
        const host = document.querySelector(
          'qplayer-embed[data-qplayer-id="' + playerId + '"]'
        );
        if (!host) throw new Error('Host not found: ' + playerId);

        const videos = host.querySelectorAll('video');
        if (videos.length !== 1) {
          throw new Error(
            playerId + ': expected exactly 1 <video>, found ' + videos.length
          );
        }
        return videos[0];
      }

      function fmt(seconds) {
        const s = Math.floor(seconds || 0);
        const m = String(Math.floor(s / 60)).padStart(2, '0');
        const r = String(s % 60).padStart(2, '0');
        return m + ':' + r;
      }

      function safePlay(video) {
        return video.play().catch(function (err) {
          // AbortError is expected when play() is interrupted by pause()
          if (err && err.name === 'AbortError') return;
          console.warn('play() failed:', err);
        });
      }

      // ---------- controls (Player 1) ----------

      function play() {
        try {
          safePlay(getVideo('player-1'));
        } catch (e) {
          console.warn(e);
        }
      }

      function pause() {
        try {
          const v = getVideo('player-1');
          if (!v.paused) v.pause();
        } catch (e) {
          console.warn(e);
        }
      }

      function mute() {
        try {
          getVideo('player-1').muted = true;
        } catch (e) {
          console.warn(e);
        }
      }

      function unMute() {
        try {
          getVideo('player-1').muted = false;
        } catch (e) {
          console.warn(e);
        }
      }

      function jumpTo10() {
        try {
          getVideo('player-1').currentTime = 10;
        } catch (e) {
          console.warn(e);
        }
      }

      // ---------- wiring ----------

      function wireEvents() {
        const v1 = getVideo('player-1');
        const v2 = getVideo('player-2');

        v1.addEventListener('timeupdate', function () {
          document.getElementById('playerPos1').textContent = fmt(v1.currentTime);
        });

        v2.addEventListener('timeupdate', function () {
          document.getElementById('playerPos2').textContent = fmt(v2.currentTime);
        });

        v1.addEventListener('play', function () {
          if (!v2.paused) v2.pause();
        });

        console.log('Event wiring complete');
      }

      // videos are rendered async → poll once
      (function init() {
        const start = Date.now();
        const timer = setInterval(function () {
          try {
            wireEvents();
            clearInterval(timer);
          } catch (e) {
            if (Date.now() - start > 10000) {
              clearInterval(timer);
              console.warn('Timed out waiting for videos');
            }
          }
        }, 100);
      })();
    </script>
  </body>
</html>
